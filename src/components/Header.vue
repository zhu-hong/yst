<script setup>
import { computed, getCurrentInstance } from 'vue'
import { useMeStore } from '@/store/me'

const ToHome = () => {
  window.open(`${HOME_URL}/pc/platform2/`)
}

const ins = getCurrentInstance()
const router = ins.proxy.$router
const route = computed(() => ins.proxy.$route)

const meStore = useMeStore()
meStore.getMe()

const me = computed(() => meStore.me)

const toRootPath = () => {
  const matchedPath = route.value.matched.map((r) => r.path)
  if(matchedPath.some((path) => path === '')) return

  router.push('/')
}
</script>

<template>
  <header class="h-64px bg-[#223361] px-32px flex justify-between items-center text-white flex-none">
    <div class="flex items-center">
      <svg class="cursor-pointer" @click="ToHome" width="142" height="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="a" d="M0 32h141.138V0H0z"/></defs><g fill="none" fill-rule="evenodd"><path d="m68.42 12.046 2.63-2.856 2.813-3.055a.092.092 0 0 0-.067-.154h-3.994a.09.09 0 0 0-.067.029l-2.988 3.18-.452.482-.452-.482-2.987-3.18a.092.092 0 0 0-.067-.03H58.8a.092.092 0 0 0-.067.155l2.813 3.055 2.63 2.856-6.401 6.876a.092.092 0 0 0 .067.154h3.967a.09.09 0 0 0 .066-.029l4.42-4.622 4.415 4.622a.091.091 0 0 0 .067.029h3.982c.08 0 .122-.096.067-.154l-6.407-6.876Zm3.877 19.818v-7.973h5.765v.941h-4.71v2.442h4.41v.935h-4.41v2.714h4.894v.941zm8.018 0v-7.973h5.379v.941H81.37v2.47h3.742v.94H81.37v3.622zm7.361 0v-7.973h5.379v.941H88.73v2.47h3.742v.94H88.73v3.622z" fill="#FFF"/><mask id="b" fill="#fff"><use xlink:href="#a"/></mask><path fill="#FFF" mask="url(#b)" d="M95.162 31.864h1.055V23.89h-1.055zm4.238-3.867c0 .961.259 1.718.775 2.27.517.554 1.165.83 1.944.83.795 0 1.448-.279 1.961-.837.513-.559.77-1.35.77-2.377 0-.649-.11-1.215-.33-1.7a2.528 2.528 0 0 0-.962-1.125 2.61 2.61 0 0 0-1.422-.4c-.747 0-1.39.257-1.928.77-.539.513-.808 1.37-.808 2.57m-1.088-.017c0-1.323.355-2.36 1.066-3.108.71-.749 1.628-1.123 2.752-1.123.736 0 1.4.176 1.99.527a3.448 3.448 0 0 1 1.352 1.471c.31.63.465 1.343.465 2.14 0 .81-.163 1.533-.49 2.17a3.342 3.342 0 0 1-1.386 1.45 3.96 3.96 0 0 1-1.936.492c-.75 0-1.422-.181-2.013-.544a3.5 3.5 0 0 1-1.343-1.485 4.495 4.495 0 0 1-.457-1.99m9.694 3.883h1.115V30.75h-1.115zm9.188-2.795 1.055.266c-.221.867-.62 1.527-1.194 1.983-.574.455-1.277.682-2.107.682-.86 0-1.559-.175-2.097-.525-.538-.35-.948-.856-1.23-1.52a5.431 5.431 0 0 1-.42-2.137c0-.83.158-1.555.475-2.173a3.26 3.26 0 0 1 1.355-1.408 3.954 3.954 0 0 1 1.933-.482c.798 0 1.468.203 2.012.61.544.406.923.977 1.137 1.712l-1.039.245c-.185-.58-.453-1.002-.805-1.267-.351-.265-.794-.397-1.327-.397-.612 0-1.125.147-1.536.44-.412.294-.7.689-.867 1.184a4.763 4.763 0 0 0-.25 1.53c0 .679.098 1.27.296 1.776.197.506.505.884.922 1.134.417.25.868.375 1.354.375.59 0 1.09-.17 1.5-.511.41-.34.688-.847.833-1.517m2.901 2.795v-7.973h1.082l4.188 6.26v-6.26h1.011v7.973h-1.082l-4.188-6.265v6.265zm-56.959-3.821h4.561v-.306h-4.561zm67.5 0h4.561v-.306h-4.561zm8.619-23.933H125.78a.092.092 0 0 1-.092-.098l.129-1.7a.092.092 0 0 1 .091-.086h13.477c.053 0 .095.046.091.1l-.128 1.7a.092.092 0 0 1-.092.084m-11.032 12.474h8.362a125.372 125.372 0 0 1-2.742-4.52c-.035-.06.004-.136.074-.136h2.349c.026 0 .045.012.059.034 1.286 2.1 2.986 4.492 4.795 6.946a.092.092 0 0 1-.074.147h-1.363c-.948 0-1.83-.486-2.334-1.289l-.194-.309-.543 1.176a.092.092 0 0 1-.084.053h-12.917a.09.09 0 0 1-.07-.149c2.433-2.947 4.605-6.085 6.166-8.965h-5.905a.09.09 0 0 1-.09-.097l.11-1.78a.092.092 0 0 1 .092-.087h17.102c.053 0 .095.044.092.097l-.11 1.781a.092.092 0 0 1-.092.086h-8.23c-1.545 2.657-3.015 4.95-4.525 6.867a.09.09 0 0 0 .072.145m-35.245.209h-9.142a.092.092 0 0 1-.091-.092v-4.538a.09.09 0 0 1 .091-.092h9.65c.05 0 .092.04.092.092l.006 3.926c-.052.47-.252.704-.606.704m3.182-6.701-15.13.022a.092.092 0 0 0-.092.093l.15 8.664c0 .05.04.09.091.09h12.942c1.314-.152 2.028-.868 2.131-2.124v-6.653a.092.092 0 0 0-.092-.092"/><path d="M86.243 6.618h4.558c.025 0 .05.01.067.03l4.504 4.825a.093.093 0 0 0 .067.029l3.399-.008c.08 0 .122-.097.065-.155l-6.64-6.899a.093.093 0 0 0-.066-.028H84.9a.09.09 0 0 0-.068.03l-6.427 6.903a.092.092 0 0 0 .067.154l3.435-.005c.032 0 3.906-4.434 4.268-4.846a.088.088 0 0 1 .068-.03m-2.6-2.213L87.225.973a.092.092 0 0 0-.064-.158l-3.865-.01a.09.09 0 0 0-.064.025L79.67 4.282a.092.092 0 0 0 .064.158l3.847-.01c.024 0 .046-.01.063-.025m13.962-.124L93.774.84a.09.09 0 0 0-.062-.023h-3.805a.092.092 0 0 0-.064.158l3.632 3.442a.09.09 0 0 0 .063.026h4.006a.092.092 0 0 0 .062-.16M69.355 9.404H68.25l.553.548zM57.112 2.713v1.924c0 .05.041.092.092.092h18.158c.05 0 .09-.04.091-.09l.06-1.923a.092.092 0 0 0-.091-.094H67.74L67.18.685a.092.092 0 0 0-.089-.066h-2.644a.092.092 0 0 0-.088.117l.547 1.886h-7.701a.092.092 0 0 0-.092.091m60.907 2.584 1.418 11.568a.091.091 0 0 1-.091.103h-.932c-.928 0-1.71-.692-1.824-1.612l-1.239-10.037a.092.092 0 0 1 .092-.103h2.484c.046 0 .086.035.091.08Zm-3.77-.938-.002 12.525a2.123 2.123 0 0 1-2.123 2.123h-1.899a.092.092 0 0 1-.092-.094l.031-1.332a.896.896 0 0 1 .9-.875.605.605 0 0 0 .608-.615l-.207-11.732h-2.367l-.736 14.525a.092.092 0 0 1-.091.087h-2.49a.092.092 0 0 1-.092-.096l.666-14.516h-4.829a.092.092 0 0 1-.092-.094l.043-1.756a.092.092 0 0 1 .092-.09l7.446.017c-.01-.147-.294-1.603-.38-2.075a.09.09 0 0 1 .091-.106h2.664c.042 0 .079.03.089.07l.527 2.114 7.296-.02c.052 0 .094.045.092.097l-.085 1.756a.092.092 0 0 1-.092.087h-4.967Zm-8.679 1.37-1.61 9.472a1.837 1.837 0 0 1-1.863 1.528l-.895-.024a.092.092 0 0 1-.088-.107l1.863-10.968a.092.092 0 0 1 .093-.076l2.412.067a.092.092 0 0 1 .088.108ZM15.242 9.776l-4.63-2.632-5.25 3.086 9.9 5.63zm-10.51.824L0 13.38l.023 6.104 10-5.875z" fill="#FFF" mask="url(#b)"/><path fill="#FFF" mask="url(#b)" d="m15.958 10.184.039 12.24-2.84 1.657-2.616 1.527-.029-.017-5.022-2.9-.176-.101-.012-2.905-.01-2.505-5.266 3.097.02 5.36 4.026 2.29 6.537 3.742 10.686-6.214V13.192z"/><path d="M45.08 17.268c-.02-.22-.195-1.242-.232-1.42-1.008-4.973-5.482-8.656-10.62-8.537-.315.007-.474-.092-.62-.37-1.137-2.167-2.77-3.867-4.876-5.12-.97-.576-2.016-.964-3.077-1.322C25.039.243 24.38.184 23.73.095a11.425 11.425 0 0 0-2.96.002c-.738.091-1.473.213-2.174.48-1.223.427-2.41.932-3.482 1.671-1.6 1.102-2.88 2.438-3.83 4.02L14.98 8.37c1.489-2.391 3.727-3.74 6.74-3.987 3.513-.289 7.04 1.91 8.386 5.168.377.912.582 1.861.695 2.827.143.012.218-.058.305-.106 1.34-.737 2.765-1.038 4.282-.77 2.563.453 4.34 1.915 5.182 4.358.868 2.517.31 4.811-1.524 6.741-1.29 1.356-2.93 1.98-4.794 1.983-2.967.006-5.932.005-8.899.001l-7.202 4.147c5.63.001 11.258.004 16.888-.006.49-.001 1.559-.273 1.612-.285 2.917-.659 5.162-2.27 6.781-4.773.638-.986 1.036-2.076 1.37-3.193.342-1.124.358-2.271.277-3.207" fill="#FFF" mask="url(#b)"/></g></svg>
      <span class="w-1px h-30px bg-white ml-50px mr-40px"></span>
      <h1 class="text-lg cursor-pointer" @click="toRootPath">pn</h1>
    </div>
    <div class="flex items-center text-sm">
      <span>{{ me.name }}</span>
      <div class="w-32px h-32px rounded-full border-2px border-white overflow-hidden flex items-center justify-center ml-10px mr-30px">
        <img :src="me.profilePicture" v-if="me.profilePicture !== ''" @error="me.profilePicture === ''">
        <span v-else class="w-full h-full flex items-center justify-center bg-[#0c58d2] text-xs">{{ me.name.slice(-2) }}</span>
      </div>
      <div class="flex items-center gap-10px cursor-pointer" @click="meStore.logOut">
        <span>退出</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"><path d="m13.555 7.356-1.711-1.653a.705.705 0 0 1 .96-1.031l.02.019 2.93 2.836c.28.27.287.717.016.996l-2.932 3.027a.705.705 0 0 1-1.01-.98l1.752-1.806H6.598a.705.705 0 0 1 0-1.41l6.957.002ZM1.439 14.333h8.678a.703.703 0 0 1 0 1.406H.736a.705.705 0 0 1-.705-.703V.964C.031.575.347.26.736.26h9.381a.705.705 0 0 1 0 1.41h-8.68l.002 12.664Z" fill="#FFF"/></svg>
      </div>
    </div>
  </header>
</template>